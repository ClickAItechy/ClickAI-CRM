<div class="dashboard-container">
    <div class="header-section">
        <h2>Dashboard & Overview</h2>
        <p class="subtitle">Welcome back, {{ currentUser?.username | titlecase }}</p>
    </div>

    <!-- Stagnation Alert Banner -->
    <!-- Stagnation Alert Banner Removed -->

    <!-- KPI Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card card-indigo" routerLink="/dashboard/leads">
            <div class="stat-value">{{ stats.total_leads || 0 }}</div>
            <div class="stat-label">{{ isAdmin ? 'Total Leads' : 'My Leads' }}</div>
            <div class="stat-trend" *ngIf="stats.new_leads_today > 0">
                <span class="trend-up">‚Üë {{ stats.new_leads_today }} today</span>
            </div>
        </div>

        <div class="stat-card card-cyan" routerLink="/dashboard/leads" [queryParams]="{status: 'open'}">
            <div class="stat-value">{{ stats.open_leads || 0 }}</div>
            <div class="stat-label">Active Pipeline</div>
        </div>

        <div class="stat-card card-emerald" routerLink="/dashboard/deals">
            <div class="stat-value">{{ stats.total_deals || 0 }}</div>
            <div class="stat-label">Active Deals</div>
            <div class="stat-trend">
                <span>{{ stats.deals_closing_this_month || 0 }} closing soon</span>
            </div>
        </div>

        <div class="stat-card card-rose" routerLink="/dashboard/tasks">
            <div class="stat-value">{{ stats.total_tasks || 0 }}</div>
            <div class="stat-label">Pending Tasks</div>
        </div>
    </div>

    <!-- Revenue Widget -->
    <app-revenue-widget class="mb-6 block"></app-revenue-widget>

    <!-- Main Content -->
    <!-- Quick Access Sections -->
    <div class="quick-access-grid">
        <div class="access-card card-indigo" *ngIf="isSectionVisible('clients')" routerLink="/dashboard/leads"
            [queryParams]="{view: 'my-clients'}">
            <div class="access-icon">üë•</div>
            <div class="access-info">
                <h3>My Clients</h3>
                <p>Manage portfolio</p>
            </div>
        </div>

        <div class="access-card notifications-card card-amber" *ngIf="isSectionVisible('notifications')"
            routerLink="/dashboard/notifications">
            <div class="access-icon">
                üîî
                <span class="unread-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
            </div>
            <div class="access-info">
                <h3>Notifications</h3>
                <p>{{ unreadCount > 0 ? unreadCount + ' unread' : 'All caught up' }}</p>
            </div>
        </div>

        <div class="access-card reminders-card card-cyan" *ngIf="isSectionVisible('reminders')"
            routerLink="/dashboard/reminders">
            <div class="access-icon">
                ‚è∞
                <span class="unread-badge" *ngIf="reminderUnreadCount > 0">{{
                    reminderUnreadCount }}</span>
            </div>
            <div class="access-info">
                <h3>Follow-up Reminders</h3>
                <p>{{ reminderUnreadCount > 0 ? reminderUnreadCount + ' unread' : 'All caught up' }}</p>
            </div>
        </div>
        <div class="access-card tasks-card card-rose" *ngIf="isSectionVisible('tasks')" routerLink="/dashboard/tasks">
            <div class="access-icon">
                üìù

            </div>
            <div class="access-info">
                <h3>{{ isAdmin ? 'Global Tasks' : 'My Tasks' }}</h3>
                <p>{{ stats.todays_tasks?.length > 0 ? stats.todays_tasks.length + ' due today' : 'No tasks
                    today' }}</p>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
        <div class="chart-card revenue-chart">
            <div class="chart-header">
                <h4>Revenue Pipeline</h4>
            </div>
            <div class="chart-body">
                <canvas baseChart [data]="revenueChartData" [options]="revenueChartOptions"
                    [type]="revenueChartType"></canvas>
            </div>
        </div>

        <div class="chart-card health-chart">
            <div class="chart-header">
                <h4>Lead Health</h4>
            </div>
            <div class="chart-body">
                <canvas baseChart [data]="leadHealthChartData" [options]="leadHealthChartOptions"
                    [type]="leadHealthChartType"></canvas>
            </div>
        </div>
    </div>
</div>